import unittest2
from mock import patch, Mock
from squid_dynamodb import auth_helper

class AuthHelperTests(unittest2.TestCase):

    def setUp(self):
        self.authhelper = auth_helper.DynamoDbAuthHelper()

    def test_validate_password(self):
        USER_CONFIG_MOCK = Mock()
        USER_CONFIG_MOCK.get.return_value = "testpassword"
        BASIC_AUTH_CREDENTIALS = {"username": "testuser", "password":"testpassword"}
        self.assertTrue(self.authhelper.validate_password(USER_CONFIG_MOCK, BASIC_AUTH_CREDENTIALS))

    def test_validate_password_returns_false_for_none_basic_auth_params(self):
        USER_CONFIG_MOCK = Mock()
        BASIC_AUTH_CREDENTIALS = {"username": None, "password":None}
        self.assertFalse(self.authhelper.validate_password(USER_CONFIG_MOCK, BASIC_AUTH_CREDENTIALS))

    def test_validate_password_returns_false_for_empty_basic_auth_param(self):
        USER_CONFIG_MOCK = Mock()
        BASIC_AUTH_CREDENTIALS = {}
        self.assertFalse(self.authhelper.validate_password(USER_CONFIG_MOCK, BASIC_AUTH_CREDENTIALS))

    def test_parse_basic_auth_credentials(self):
        RAW_STRING = "my-user pass123"
        EXPECTED = {"username": "my-user", "password":"pass123"}
        self.assertEqual(self.authhelper.parse_basic_auth_credentials(RAW_STRING),EXPECTED )

    def test_parse_basic_auth_credentials_raises_assertion_error_for_empty_string(self):
        RAW_STRING = ""
        with self.assertRaises(AssertionError):
            self.authhelper.parse_basic_auth_credentials(RAW_STRING)

    def test_parse_basic_auth_credentials_raises_assertion_error_for_single_element_string(self):
        RAW_STRING = "my-user"
        with self.assertRaises(AssertionError):
            self.authhelper.parse_basic_auth_credentials(RAW_STRING)